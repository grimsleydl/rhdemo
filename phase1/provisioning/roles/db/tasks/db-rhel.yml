---
- name: set selinux permissive
  selinux:
    policy: targeted
    state: permissive

- name: set up hosts file
  blockinfile:
    path: /etc/hosts
    block: |
      192.168.150.31 db-1
      192.168.150.32 db-2
  tags: setup

- name: Enable HA repo
  command: yum-config-manager --enable ha
  tags: [ setup, packages ]

- name: Enable resilient-storage repo
  command: yum-config-manager --enable resilient-storage
  tags: [ setup, packages ]

- name: Install pcs packages
  yum:
    name: "{{ item }}"
    state: latest
  loop: "{{ cluster_packages | flatten(levels=1) }}"
  tags: [ setup, packages, clustering ]

- name: ensure /san/mysql-fs exists
  file:
    path: /san/mysql-fs
    state: directory
  tags: setup

- name: disable firewalld service
  service:
    name: firewalld
    state: stopped
    enabled: no
  tags: setup

- name: enable iptables service
  service:
    name: iptables
    state: started
    enabled: yes
  tags: setup

- name: Allow cluster traffic
  ansible.builtin.iptables:
    chain: INPUT
    in_interface: eth3
    jump: ACCEPT
  tags: setup

- name: Allow cluster traffic
  ansible.builtin.iptables:
    chain: INPUT
    in_interface: eth4
    jump: ACCEPT
  tags: setup
